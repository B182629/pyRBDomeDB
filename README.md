# pyRBDomeDB: pyRBDome Web-Based Database

### pyRBDomeDB is a curated database containing enhanced RNA-binding proteome data. The database is linked to a web-based interface, allowing easy retrieval and visualisation of pyRBDome data. 

#### Repository contents:

This repositry contains a collection of PHP scripts which construct the pyRBDomeDB website. These scripts are written in PHP, HTML and JavaScript. A separate 'scripts' directory contains SQL, python and YAML scripts, which have purposes outlined below. An 'Images' directory contains images used for several pyRBDomeDB webpages.

1. PHP scripts for each webpage of the pyRBdomeDB web-based interface (i.e. website).
- about_pyrbdome.php: compiles information about the pyRBDome pipeline
- feedback_pyrbdome.php: user feedback form
- filter_pyrbdome.php: tool to browse and filter data by different criteria including UniProt ID, organism, min and max prediction scores
- footer_pyrbdome.php: code for a footer bar at the bottom of a webpage
- home_pyrbdome.php: contains information about the database contents and tools
- jsmol_extra_pyrbdome.php: shows jmol prediction 3d structures for individual predictor algorithms
- jsmol_pyrbdome.php: shows jmol 3d structures of selected UniProt ID
- login.php: contains information for database connection
- menu.php: code for a menu bar at the top of a webpage containing links to all pyRBDomeDB webpages
- sequence_pyrbdome.php: retrieves sequence prediction results generated by pyRBDome pipeline

2. python script to copy data from the pyRBDome SQLite database to a MySQL database

3. sql script to initialise the pyRBDome MySQL database

4. settings yaml file

#### Setting up the mySQL pyRBDome database:

Inside the 'scripts' directory is a db_setup.sql file. This file contains a set of SQL commands to create the database and set up the individual tables like those found in the SQLite database. 
At the beginning of the file is the following SQL command:
```markdown
CREATE database if not exists pyrbdome_db ;
use pyrbdome_db ;
```
This initially sets up the database. To change the name of the database, simply replace `pyrbdome_db` with the preferred database name. Remember that the database name must be identical to that in the settings.yaml file.

The rest of the file contains SQL commands to set up the database tables. An example of creating a table:
```markdown
CREATE TABLE IF NOT EXISTS `trypsin_in_silico_peptides` (
`ID` VARCHAR(15) NOT NULL,
`pdb_id` VARCHAR(20) NOT NULL,
`chains` CHAR(1),
`Peptide` VARCHAR(50)
);
```
To create a new table not existing in the db_setup file, simply use the example above as a guideline. The table name is defined outside the brackets, whereas the column names and its respective data type is defined inside the brackets. NOTE that populating a table with data may be unsuccessful if the defined data type does not match that of the data to be inserted into a column.

To call the script and set up the mySQL database, run the following commands individually on the command line, substituting "USERNAME" with your actual mySQL username. It will then ask for the mySQL password. 

```markdown
$ cd $HOME 
$ cd pyRBDomeDB/scripts
$ mysql -u USERNAME -p < db_setup.sql
```

To check that the database and the tables have been created successfully, run the following command on the command line to launch mySQL:

```markdown
$ mysql -u USERNAME -p
```
Change the database to use the pyRBDome database (replace `pyrbdome_db` with the actual database name) and list the table names in the database:
```markdown
mysql> USE pyrbdome_db ;
mysql> SHOW TABLES ;
```
Check the schema of one of the tables (replace `available_pdbs` with the table name of interest):

```markdown
mysql> DESCRIBE available_pdbs ;
```

If the database setup is successful, the database is ready to be populated (see below).

If the database schema looks incorrect, individual tables can be modified or the database can be deleted and set up again (following modification of the db_setup.sql script). Find out how to make table modifications here: https://www.techonthenet.com/mysql/tables/alter_table.php

## Populating the mySQL database:

The transfer_data.ipynb Jupyter Notebook script retrieves pyRBDome results stored in the SQLite database and copies them to the initialised mySQL database. It also retrieves the organism name related to the UniProt ID and stores this information in a mySQL table.

#### Additional setup requirements:

**Downloading Jmol:**

JSmol objects requires a separate installation of Jmol. Ensure the pyRBDomeDB git repository is cloned before downloading Jmol. 

**Step 1:** Visit https://jmol.sourceforge.net/download/ and download the Jmol zip file from SourceForge using the direct link.

**Step 2:** Transfer the downloaded Jmol zip file to the preferred location (e.g. local machine desktop) and unzip the file.

**Step 3:** Open the unzipped Jmol folder and unzip the JSmol folder (jsmol.zip).

**Step 4:** Transfer the unzipped JSmol folder into the cloned pyRBDomeDB directory (do not put it in a sub-directory, leave it in the parent directory).

*Avoid editing/moving the contents inside the JSmol folder. JSmol may not work properly if the contents inside the JSmol folder are tampered with.*

**Editing the settings YAML file:**

The pyRBDomeDB contains a settings.yaml file in the 'scripts' directory. This file needs to be edited with correct MySQL and SQLite database information (and output file path if applicable).

```markdown
- database:
    host: "dapanther.bio.ed.ac.uk"       
    username: "mySQL_user"               
    password: "mySQL_password"  
    database_name: "pyrbdome_db"         
    database_path: "./pyrbdome_full.db"  
```

**Host:** The IP address or server name to connect to the mySQL database (i.e. the server address where the mySQL database was set up).

**Username:** mySQL account username (i.e. the account where the pyRBDomeDB mySQL database has been already set up).

**Password** mySQL account password.

**Database name:** mySQL pyRBDome database name.

**Database path:** The path to the SQLite database relative to the settings.yaml file.

