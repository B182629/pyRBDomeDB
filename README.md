# pyRBDomeDB: the pyRBDome Web-Based Database

#### pyRBDomeDB is a curated database containing enhanced RNA-binding proteome data. The database is linked to a web-based interface, allowing easy retrieval and visualisation of pyRBDome data. 


## Repository contents:

This repositry contains a collection of PHP scripts which construct the pyRBDomeDB website. These scripts are written in PHP, HTML and JavaScript. A separate 'scripts' directory contains SQL, python and YAML scripts, which have purposes outlined below. An 'Images' directory contains images used in several pyRBDomeDB webpages.


1. PHP scripts for each webpage of the pyRBdomeDB web-based interface (i.e. website).
    - about_pyrbdome.php: compiles information about the pyRBDome pipeline.
    - feedback_pyrbdome.php: user feedback form.
    - filter_pyrbdome.php: tool to browse and filter data by different criteria including UniProt ID, organism, min and max prediction scores.
    - footer_pyrbdome.php: script containing code for a footer bar at the bottom of each webpage.
    - home_pyrbdome.php: home page containing information about the database contents and tools.
    - jsmol_extra_pyrbdome.php: shows jmol prediction 3d structures for individual predictor algorithms.
    - jsmol_pyrbdome.php: shows jmol 3D structures of selected UniProt ID.
    - login_pyrbdome.php: contains information used for database connection.
    - menu_pyrbdome.php: script containing code for a menu bar at the top of a webpage containing links to all pyRBDomeDB webpages.
    - sequence_pyrbdome.php: retrieves sequence prediction results generated by pyRBDome pipeline.


2. Various scripts to set up SQL database, populate database and configure settings.
    - transfer_data.ipynb: python script which copies data from the pyRBDome SQLite database to a MySQL database.
    - db_setup.sql: SQL script to initialise the pyRBDome MySQL database and create tables.
    - settings.yaml: a YAML settings file allowing user to set parameters for the transfer_data.ipynb script.

3. Image files displayed on several webpages.



## Setting up the mySQL pyRBDome database:

Inside the 'scripts' directory is a db_setup.sql file. This file contains a set of SQL commands to create the database and set up the individual tables like those found in the SQLite database. 
At the beginning of the file is the following SQL command:
```markdown
CREATE database if not exists pyrbdome_db ;
use pyrbdome_db ;
```
This initially sets up the database. To change the name of the database, simply replace `pyrbdome_db` with the preferred database name. Remember that the database name must be identical to that in the settings.yaml file.

The rest of the file contains SQL commands to set up the database tables. An example of creating a table:
```markdown
CREATE TABLE IF NOT EXISTS `trypsin_in_silico_peptides` (
`ID` VARCHAR(15) NOT NULL,
`pdb_id` VARCHAR(20) NOT NULL,
`chains` CHAR(1),
`Peptide` VARCHAR(50)
);
```
To create a new table not existing in the db_setup file, simply use the example above as a guideline. The table name is defined outside the brackets, whereas the column names and its respective data type is defined inside the brackets. NOTE that populating a table with data may be unsuccessful if the defined data type does not match that of the data to be inserted into a column.

To call the script and set up the mySQL database, run the following commands individually on the command line, substituting "USERNAME" with your actual mySQL username. It will then ask for the mySQL password. 

```markdown
$ cd $HOME 
$ cd pyRBDomeDB/scripts
$ mysql -u USERNAME -p < db_setup.sql
```

To check that the database and the tables have been created successfully, run the following command on the command line to launch mySQL:

```markdown
$ mysql -u USERNAME -p
```
Change the database to use the pyRBDome database (replace `pyrbdome_db` with the actual database name) and list the table names in the database:
```markdown
mysql> USE pyrbdome_db ;
mysql> SHOW TABLES ;
```
Check the schema of one of the tables (replace `available_pdbs` with the table name of interest):

```markdown
mysql> DESCRIBE available_pdbs ;
```

If the database setup is successful, the database is ready to be populated (see below).

If the database schema looks incorrect, individual tables can be modified or the database can be deleted and set up again (following modification of the db_setup.sql script). Find out how to make table modifications here: https://www.techonthenet.com/mysql/tables/alter_table.php


## Populating the mySQL database:

The transfer_data.ipynb Jupyter Notebook script retrieves pyRBDome results stored in the SQLite database and copies them to the initialised mySQL database. It also retrieves the organism name related to the UniProt ID and stores this information in a mySQL table. Data already existing in the mySQL database will not be duplicated.

**How it works:**

The script reads the SQLite database, and fetches the names of all tables in the SQLite database. For each database table, a pandas dataframe is created, changing inappropriate column names (i.e. those containing whitespace) to appropriate names and replacing empty values and inf values with values readable by mySQL to avoid errors. For each column in each table, the script automatically checks that the data type of the column matches that of the data being inserted (e.g. mySQL columns with data type `VARCHAR(10)` are inserted with string values containing various characters less than or equal to a length of 10). The script also reads the mySQL table to ensure existing rows are not duplicated during table population.

**Updating pyRBDomeDB with new data:**

Updating the mySQL database with new data is simple. Simply execute the whole script, and only new data found in the SQLite database will be appended to the mySQL database.

**If database population is unsuccessful:**

If a significant error occurs during population, the population process is terminated and the error returned will inform you which column in which table the error occurred. A minor error, for example a specific value in a row is too long and does not match the column data type, the row will not be inserted into the table but population will proceed. An error message will be returned informing where the error ocurred.

**Retrieving organism information:**

The beginning of the script attempts to retrieve organism information for each UniProt ID found in the SQLite database. It does this by using the NCBI E-utilities service. Using this service may sometimes result in errors. This may be due to different reasons, but the most common reason is unresponsiveness to high traffic. If this occurs, it is recommended to rertry during off-peak times (more information: https://www.ncbi.nlm.nih.gov/books/NBK25497/#chapter2.Usage_Guidelines_and_Requiremen).

## Setting up the web-based interface:

Once the pyRBDome database has been set up and populated, 

## Additional setup requirements:

### Downloading Jmol:

JSmol objects requires a separate installation of Jmol. Ensure the pyRBDomeDB git repository is cloned before downloading Jmol. 

**Step 1:** Visit https://jmol.sourceforge.net/download/ and download the Jmol zip file from SourceForge using the direct link.

**Step 2:** Transfer the downloaded Jmol zip file to the preferred location (e.g. local machine desktop) and unzip the file. *It is recommended that Jmol version 16.1.25 is used, as the more recent versions do not seem to work.*

**Step 3:** Open the unzipped Jmol folder and unzip the JSmol folder (jsmol.zip).

**Step 4:** Transfer the unzipped JSmol folder into the cloned pyRBDomeDB directory (do not put it in a sub-directory, leave it in the parent directory).

*Avoid editing/moving the contents inside the JSmol folder. JSmol may not work properly if the contents inside the JSmol folder are tampered with.*

### Editing the login_pyrbdome.php file:

To establish mySQL database connection, the login.php file must be edited with the correct details.

```markdown
$hostname = 'dapanther.bio.ed.ac.uk';
$database = 'pyrbdome_db';
$username = 'mySQL_user';
$password = 'mySQL_password';
$email = 'example@ed.ac.uk';
```
**Hostname:** The IP address or server name to connect to the mySQL database (i.e. the server address where the mySQL database was set up).

**Database:** mySQL pyRBDome database name.

**Username:** mySQL account username (i.e. the account where the pyRBDomeDB mySQL database has been already set up).

**Password:** mySQL account password.

**Email:** Your email address. This email will recieve pyRBDome feedback.



### Editing the settings.yaml file:

The pyRBDomeDB contains a settings.yaml file in the 'scripts' directory. This file needs to be edited with correct MySQL and SQLite database information (and output file path if applicable) for database population to be successful.

```markdown
- database:
    host: "dapanther.bio.ed.ac.uk"       
    username: "mySQL_user"               
    password: "mySQL_password"  
    database_name: "pyrbdome_db"         
    database_path: "./pyrbdome_full.db"
- output:
    output_file_path: "./output_files"
- Entrez:
    email: "example@ed.ac.uk"
```

**Host:** The IP address or server name to connect to the mySQL database (i.e. the server address where the mySQL database was set up).

**Username:** mySQL account username (i.e. the account where the pyRBDomeDB mySQL database has been already set up).

**Password** mySQL account password.

**Database name:** mySQL pyRBDome database name.

**Database path:** The path to the **SQLite** database relative to the settings.yaml file.

**Output_file_path:** This is the file path to the SQLite database table text files which can be created (optional).

**Email:** Entrez E-utilities requires an email to be specified when submitting requests.
